<section class="content px-2 mt-2">
  <div class="container-fluid">
    <div class="">
      <div class="">
        <div class="input-group">
          <div class="input-group-prepend">
            <button type="button" class="btn bg-blue" (click)="getDataPage(1)">
              <i class="fas fa-search"></i>
            </button>
          </div>
          <input type="text" class="form-control" name="keyword" placeholder="Search" [(ngModel)]="searchText"
            (keyup.enter)="getDataPage(1)" />
          <div class="input-group-append">
            <button type="button" class="btn btn-default" (click)="checkAddFilter()">
              <i class="fas" [class.fa-angle-up]="advancedFiltersVisible"
                [class.fa-angle-down]="!advancedFiltersVisible"></i>
            </button>
          </div>
        </div>
      </div>
      <div *ngIf="advancedFiltersVisible" class="mb-0 mt-1">
        <div class="card-body">
          <form class="form-horizontal">
            <div class="row">
              <div class="col-md-12 col-xl-12">
                <div class="mb-0">
                  <div>
                    <div *ngFor="let item of filterItems; let i = index">
                      <app-filter [item]="item" (emitChange)="onEmitChange($event, i)"
                        (deleteDataFilter)="deleteFilterItem(i)" [inputFilters]="FILTER_CONFIG">
                      </app-filter>
                    </div>
                    <i style="padding: 0" class="fas fa-plus-circle ml-3" (click)="addFilter()"></i>
                  </div>
                </div>
              </div>
            </div>
          </form>
          <!-- <div class="col-4">
                        <div>
                            <mat-form-field class="w-75" appearance="outline">
                                <mat-select class="w-100" [(ngModel)]="skill" aria-placeholder="Select Skill" name="skill" (selectionChange)="filterSkills($event.value)" placeholder="Search skill">
                                    <mat-option *ngFor="let skill of listSkills" [value]="skill.id">
                                        {{skill.name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                    </div> -->
        </div>
      </div>
      <div class="table-responsive py-4 pool-table">
        <div class="fixTableHead">
          <table [busy]="isLoading" style="border-collapse: collapse" class="table table-hover text-nowrap">
            <thead class="bg-light">
              <tr style="border: none">
                <th class="stt">#</th>
                <th>Employee</th>
                <th style="width: 75px;">History</th>
                <th>Temp Projects</th>
                <th style="width: 200px;">Skills</th>
                <th>Note</th>
                <th style="width: 100px;">Date Start Pool</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="
                  let item of availableResourceList
                    | paginate
                      : {
                          id: 'server',
                          itemsPerPage: pageSize,
                          currentPage: pageNumber,
                          totalItems: totalItems
                        };
                  let i = index
                ">
                <td class="text-center">
                  <span>{{ i + 1 }}</span>
                </td>
                <td style="width: 350px;">
                  <div style="width: 100%;">
                    <app-user-info [userData]="{
                        fullName: item.fullName,
                        branch: item.branch,
                        userType: item.userType,
                        emailAddress: item.emailAddress,
                        avatarPath: item.avatarPath,
                        rateStar:item.starRate,
                        userLevel: item.userLevel
                      }">
                    </app-user-info>
                  </div>
                </td>
                <td class="text-center">
                  <i class="fas fa-history fa-lg" (click)="projectHistorUser(item)"
                    matTooltip="Xem dự án trước đây"></i>
                </td>

                <td style="white-space: normal; max-width: 200px">
                  <div class="d-flex " style="align-items: center;">
                    <div style="width: 90%;">
                      <div *ngFor="let plan of item.projectUserPlans" (mouseenter)="plan.onHover = true;"
                        (mouseleave)="plan.onHover = false" style="white-space: nowrap;">
                        <span [ngClass]="plan.onHover?'on-hover-plan':''">
                          <strong>{{ plan.projectName }}</strong> - {{ plan.startTime | date: 'dd/MM/yyyy' }}
                        </span>
                        <span style="display: inline-block; width: 10px;">
                          <i *ngIf="plan.onHover && (permission.isGranted(DeliveryManagement_ResourceRequest_CancelAnyPlanResource) 
                          || isAllowCancelPlan(plan.creatorUserId))" 
                          class="fas fa-times pointer text-danger ml-1"
                            (click)="CancelResourcePlan(plan,item.fullName)"></i>
                        </span>
                      </div>
                    </div>
                    <div style="width: 10%;" class="text-right">
                      <i class="fas fa-edit" (click)="planUser(item)" matTooltip="Plan user"></i>
                    </div>
                  </div>

                </td>
                <td style="white-space: normal; max-width: 200px">
                  <div class="d-flex" style="align-items: center;">
                    <div style="width: 90%">
                      <p class="m-0" *ngFor="let item of item.listSkills">
                        - {{item.name}}

                      </p>
                      <!-- {{ skillsCommas(item.listSkills) }} -->
                    </div>
                    <div style="width: 10%; text-align: right;">
                      <i class="fas fa-edit" (click)="updateUserSkill(item)" matTooltip="Edit skill"></i>
                    </div>
                  </div>
                </td>
                <td style="
                    white-space: pre-line;
                    word-break: break-all;
                    max-width: 200px;
                    min-width: 150px;
                  ">
                  <div class="d-flex" style="align-items: center">
                    <div style="width: 90%">{{ item.poolNote }}
                    </div>
                    <div style="width: 10%; text-align: right;">
                      <i class="fas fa-edit " (click)="updateNote(item.userId, item.fullName)"
                        matTooltip="Edit note"></i>
                    </div>
                  </div>
                </td>
                <td class="text-center">
                  {{
                  item.dateStartPool !== 0
                  ? formatDateStartPool(item.dateStartPool)
                  : ''
                  }}
                  <p *ngIf="item.totalFreeDay > 0"><strong>{{ item.totalFreeDay }}</strong> days ago</p>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="bg-light border-top pt-2">
        <div class="row">
          <div class="col-sm-4 col-12 text-sm-left text-center">
            <button class="btn btn-secondary mb-2" (click)="refresh()">
              <i class="fas fa-redo-alt"></i>
            </button>
            <mat-form-field style="width: 20%; margin-left: 30px">
              <mat-label>Number items</mat-label>
              <mat-select [(ngModel)]="pageSizeType" (ngModelChange)="changePageSize()">
                <mat-option [value]="5"> 5 </mat-option>
                <mat-option [value]="10"> 10 </mat-option>
                <mat-option [value]="20"> 20 </mat-option>
                <mat-option [value]="50"> 50 </mat-option>
                <mat-option [value]="100"> 100 </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col-sm-4 col-12 text-center">
            <p class="mb-0 my-2">
              {{ 'TotalRecordsCount' | localize: totalItems }}
            </p>
          </div>
          <div class="col-sm-4 col-12">
            <div class="float-sm-right m-auto">
              <abp-pagination-controls id="server" (pageChange)="getDataPage($event)">
              </abp-pagination-controls>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>